<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cskaoyan.hackernews.mapper.NewsMapper">
    <resultMap id="BaseResultMap" type="com.cskaoyan.hackernews.bean.News">
    <result column="id" property="id"/>
    <result column="image" property="image"/>
    <result column="like_count" property="likeCount" />
    <result column="comment_count" property="commentCount" />
    <result column="created_date" property="createdDate" />
    <result column="title" property="title" />
    <result column="link" property="link" />
    <association column="user_id" property="user"  select="com.cskaoyan.hackernews.mapper.UserMapper.selectById"/>
  </resultMap>
  <sql id="Base_Column_List">
    id, image, like_count, comment_count, created_date, title, link, user_id
  </sql>

  <select id="selectById" resultMap="BaseResultMap">
    select <include refid="Base_Column_List"/>
    from news where id = #{newsId}
  </select>

  <select id="selectAllNews" resultMap="BaseResultMap">
    select <include refid="Base_Column_List"/>
    from news
  </select>

  <insert id="insert">
      insert into news (title, link, image, created_date,like_count,comment_count,user_id)
      value (#{news.title}, #{news.link}, #{news.image}, #{news.createdDate},0,0,#{userId})
  </insert>

  <update id="addCommentCount">
      update news
      set comment_count = comment_count + 1
      where id = #{newsId}
  </update>

  <update id="updateLikeCount">
      update news
      set like_count = #{likeCount}
      where id = #{newsId}
  </update>
</mapper>